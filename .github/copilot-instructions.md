# Copilot Instructions for lazy-wrappers

## Project Overview

Lazy-wrappers provides shell wrapper scripts that defer loading `nvm` (Node.js) and `rbenv` (Ruby) until actually needed, speeding up shell startup. All wrappers are **generated dynamically** at install time from a single config file.

## Architecture

```
install.sh              → Main entry point, copies to ~/.lazy-wrappers and runs generator
uninstall.sh            → Cleans up shell configs and optionally removes installation
scripts/
  wrappers.conf         → Single source of truth: lists all binaries to wrap
  generate_wrappers  → Reads wrappers.conf, generates wrapper scripts
  config                → Shell detection (bash/zsh) and path variables
  nvmload               → Lazy loader for nvm (auto-clones if missing)
  rbenvload             → Lazy loader for rbenv (auto-clones if missing)
  shell-hook         → Post-command hook to clean up PATH after loading
  bin/
    node_wrappers/      → Generated wrappers for Node.js binaries (empty in repo)
    ruby_wrappers/      → Generated wrappers for Ruby binaries (empty in repo)
```

## Key Patterns

### Adding new binaries

Edit `scripts/wrappers.conf` - format is `binary_name:loader` where loader is `nvm` or `rbenv`:

```
my-tool:nvm
my-gem:rbenv
```

### Wrapper generation

Wrappers are generated by `generate_wrappers` using heredoc templates with `BINARY_NAME` placeholder replaced via `sed`. Each wrapper:

1. Removes its own directory from PATH (prevents recursion)
2. Sources the appropriate loader (`nvmload` or `rbenvload`) if binary not found
3. Execs the real binary

### Testing changes

```bash
./install.sh          # Install to ~/.lazy-wrappers
source ~/.bashrc      # or ~/.zshrc
node --version        # Triggers lazy load
./uninstall.sh        # Clean removal
```

## Conventions

- All scripts use `#!/bin/bash` with `set -euo pipefail` for strict mode
- Wrapper directories (`bin/node_wrappers/`, `bin/ruby_wrappers/`) contain only `.gitkeep` in repo - content is generated
- Shell config modifications are marked with `# lazy-wrappers:` comment for easy identification
- Loaders use `*_ALREADY_LOADED` env vars to prevent redundant initialization
